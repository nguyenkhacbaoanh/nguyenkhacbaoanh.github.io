{"componentChunkName":"component---src-templates-post-js","path":"/pensieve/yoga","result":{"data":{"markdownRemark":{"html":"<h2>Architecture</h2>\n<p><img src=\"./yoga_architecture.png\" alt=\"Architecture de projet\" title=\"architecture\"></p>\n<h2>Data Flow</h2>\n<p><img src=\"./pipelines.png\" alt=\"Data flow\" title=\"pipeline jobs\"></p>\n<h2>Control Data</h2>\n<h3>Control KPI</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\">/*****************************\nPROD - KPI YOGA\n\nmaj : 01/03/2023\n******************************/</span>\n\n<span class=\"token comment\">--Change the phase value </span>\n<span class=\"token variable\">@set</span> phase <span class=\"token operator\">=</span> <span class=\"token string\">'BR2'</span>\n\n<span class=\"token keyword\">with</span> rcc_kpi <span class=\"token keyword\">as</span>\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">select</span> \n  \tcode_irt_bdf<span class=\"token punctuation\">,</span> label_irt_bdf<span class=\"token punctuation\">,</span> \n  \tphase<span class=\"token punctuation\">,</span>\n  \t<span class=\"token function\">count</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> nb_cnt_total<span class=\"token punctuation\">,</span>\n  \t<span class=\"token function\">count</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">case</span> <span class=\"token keyword\">when</span> flag_cnt_found <span class=\"token operator\">=</span> <span class=\"token string\">'Y'</span> <span class=\"token keyword\">then</span> <span class=\"token number\">1</span> <span class=\"token keyword\">end</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> nb_ctn_rapp<span class=\"token punctuation\">,</span>\n  \t<span class=\"token function\">count</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">case</span> <span class=\"token keyword\">when</span> flag_cnt_amount_matched <span class=\"token operator\">=</span> <span class=\"token string\">'Y'</span> <span class=\"token keyword\">then</span> <span class=\"token number\">1</span> <span class=\"token keyword\">end</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> nb_ctn_reconl<span class=\"token punctuation\">,</span>\n  \t<span class=\"token function\">count</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">case</span> <span class=\"token keyword\">when</span> flag_dep_pci <span class=\"token operator\">=</span> <span class=\"token string\">'P'</span> <span class=\"token keyword\">then</span> <span class=\"token number\">1</span> <span class=\"token keyword\">end</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> nb_ctn_deport\n\t<span class=\"token keyword\">from</span> hive_default_lucid_prd<span class=\"token punctuation\">.</span>prd_suv_fni_a8401_accounting_granular<span class=\"token punctuation\">.</span>suv_rcc_yoga\n  \t<span class=\"token keyword\">where</span> <span class=\"token number\">1</span><span class=\"token operator\">=</span><span class=\"token number\">1</span>\n  \t<span class=\"token operator\">and</span> phase <span class=\"token operator\">=</span> ${phase}\n  \t<span class=\"token operator\">and</span> flag_pci_remove <span class=\"token operator\">=</span> <span class=\"token string\">'N'</span> \n  \t<span class=\"token operator\">and</span> <span class=\"token keyword\">coalesce</span><span class=\"token punctuation\">(</span>code_irt_bdf<span class=\"token punctuation\">,</span> <span class=\"token string\">'AAAAA'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">not</span> <span class=\"token operator\">in</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'A0021'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'A1787'</span><span class=\"token punctuation\">)</span>\n  \t<span class=\"token keyword\">group</span> <span class=\"token keyword\">by</span> code_irt_bdf<span class=\"token punctuation\">,</span> label_irt_bdf<span class=\"token punctuation\">,</span> phase\n  \t<span class=\"token keyword\">order</span> <span class=\"token keyword\">by</span> label_irt_bdf <span class=\"token keyword\">asc</span> nulls <span class=\"token keyword\">first</span>\n<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">select</span>\n  code_irt_bdf<span class=\"token punctuation\">,</span> label_irt_bdf<span class=\"token punctuation\">,</span>phase<span class=\"token punctuation\">,</span>\n  nb_cnt_total<span class=\"token punctuation\">,</span> nb_ctn_rapp<span class=\"token punctuation\">,</span>\n  <span class=\"token function\">round</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>cast<span class=\"token punctuation\">(</span>nb_ctn_rapp <span class=\"token keyword\">as</span> <span class=\"token keyword\">double</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> cast<span class=\"token punctuation\">(</span>nb_cnt_total <span class=\"token keyword\">as</span> <span class=\"token keyword\">double</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">100</span> <span class=\"token keyword\">as</span> pct_cnt_rapp<span class=\"token punctuation\">,</span>\n  nb_ctn_reconl<span class=\"token punctuation\">,</span>\n  <span class=\"token function\">round</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>cast<span class=\"token punctuation\">(</span>nb_ctn_reconl <span class=\"token keyword\">as</span> <span class=\"token keyword\">double</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> cast<span class=\"token punctuation\">(</span>nb_cnt_total <span class=\"token keyword\">as</span> <span class=\"token keyword\">double</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">100</span> <span class=\"token keyword\">as</span> pct_cnt_reconl<span class=\"token punctuation\">,</span>\n  nb_ctn_rapp <span class=\"token operator\">-</span> nb_ctn_reconl <span class=\"token keyword\">as</span> nb_ctn_rapp_nreconl<span class=\"token punctuation\">,</span>\n  nb_ctn_deport<span class=\"token punctuation\">,</span>\n  nb_cnt_total <span class=\"token operator\">-</span> nb_ctn_rapp <span class=\"token keyword\">as</span> nb_ctn_nrapp\n<span class=\"token keyword\">from</span> rcc_kpi\n<span class=\"token punctuation\">;</span></code></pre></div>\n<h3>Control integration du SO</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\">/*****************************\nControle Transco \n\nmaj : 01/03/2023\n******************************/</span>\n\n<span class=\"token comment\">--Change the phase value </span>\n<span class=\"token variable\">@set</span> phase <span class=\"token operator\">=</span> <span class=\"token string\">'BR2'</span>\n\n<span class=\"token comment\">/***Controle SRV ***/</span>\n<span class=\"token keyword\">select</span> cd_banque_origin<span class=\"token punctuation\">,</span> <span class=\"token function\">count</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> \n<span class=\"token keyword\">from</span> ${hive_default_lucid_prd<span class=\"token punctuation\">.</span>prd}_srv_fni_a8401_fda_datastructure<span class=\"token punctuation\">.</span>yoga_contracts_transco\n<span class=\"token keyword\">where</span> phase <span class=\"token operator\">=</span> ${phase}\n<span class=\"token keyword\">group</span> <span class=\"token keyword\">by</span> cd_banque_origin<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/***Controle SUV ***/</span>\n\n<span class=\"token comment\">-- Detail par SO</span>\n<span class=\"token keyword\">select</span> cd_irt_so_cible<span class=\"token punctuation\">,</span> label_irt<span class=\"token punctuation\">,</span> <span class=\"token function\">count</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> trsc<span class=\"token punctuation\">.</span>insert_date\n<span class=\"token keyword\">from</span> hive_default_lucid_prd<span class=\"token punctuation\">.</span>prd_suv_fni_a8401_accounting_granular<span class=\"token punctuation\">.</span>suv_contracts_transco_yoga trsc\n<span class=\"token keyword\">left</span> <span class=\"token keyword\">outer</span> <span class=\"token keyword\">join</span> hive_default_lucid_prd<span class=\"token punctuation\">.</span>prd_srv_fni_a8401_fda_datastructure<span class=\"token punctuation\">.</span>sv_fni_ref_irt irt <span class=\"token keyword\">on</span> <span class=\"token punctuation\">(</span>cd_irt_so_cible <span class=\"token operator\">=</span> irt<span class=\"token punctuation\">.</span>code_irt<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">where</span> phase <span class=\"token operator\">=</span> ${phase} \n<span class=\"token keyword\">group</span> <span class=\"token keyword\">by</span> cd_irt_so_cible<span class=\"token punctuation\">,</span> label_irt<span class=\"token punctuation\">,</span> trsc<span class=\"token punctuation\">.</span>insert_date\n<span class=\"token keyword\">order</span> <span class=\"token keyword\">by</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">-- Par Banque</span>\n<span class=\"token keyword\">select</span> cd_banque_origin<span class=\"token punctuation\">,</span> trsc<span class=\"token punctuation\">.</span>insert_date<span class=\"token punctuation\">,</span> phase<span class=\"token punctuation\">,</span> <span class=\"token function\">count</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> \n<span class=\"token keyword\">from</span> hive_default_lucid_prd<span class=\"token punctuation\">.</span>prd_suv_fni_a8401_accounting_granular<span class=\"token punctuation\">.</span>suv_contracts_transco_yoga trsc\n<span class=\"token keyword\">where</span> phase <span class=\"token operator\">=</span> ${phase}\n<span class=\"token keyword\">group</span> <span class=\"token keyword\">by</span> cd_banque_origin<span class=\"token punctuation\">,</span> trsc<span class=\"token punctuation\">.</span>insert_date<span class=\"token punctuation\">,</span> phase\n<span class=\"token keyword\">order</span> <span class=\"token keyword\">by</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>Control data daily pour des jours ouvres</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\">/*****************************\nPROD des SRV YOGA\n\nmaj : 01/03/2023\n******************************/</span>\n\n<span class=\"token variable\">@set</span> env_ins_dt <span class=\"token operator\">=</span> <span class=\"token string\">'2023-05-13'</span>\n\n<span class=\"token comment\">--Controle des CRE recus par SO</span>\n<span class=\"token keyword\">select</span> \ncgxmj<span class=\"token punctuation\">.</span>insert_date<span class=\"token punctuation\">,</span> \ncgxmj<span class=\"token punctuation\">.</span>cdirt <span class=\"token keyword\">as</span> IRT<span class=\"token punctuation\">,</span>\nlabel_irt<span class=\"token punctuation\">,</span>\n<span class=\"token keyword\">case</span> <span class=\"token keyword\">when</span> cgxmj<span class=\"token punctuation\">.</span>cdggpn <span class=\"token operator\">in</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'07141'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'07142'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'07143'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'07144'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'07145'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'07146'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'07147'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'07148'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'07149'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">then</span> <span class=\"token string\">'YOGA'</span> <span class=\"token keyword\">else</span> <span class=\"token string\">'RCGG'</span> <span class=\"token keyword\">end</span> <span class=\"token keyword\">as</span> Type_CRE<span class=\"token punctuation\">,</span>\n<span class=\"token function\">count</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> Nbre\n<span class=\"token keyword\">from</span> hive_default_lucid_prd<span class=\"token punctuation\">.</span>prd_srv_nsa_a2274_nosica<span class=\"token punctuation\">.</span>sv_cgxmj_bis cgxmj\n<span class=\"token keyword\">left</span> <span class=\"token keyword\">outer</span> <span class=\"token keyword\">join</span> hive_default_lucid_prd<span class=\"token punctuation\">.</span>prd_srv_nsa_a2274_nosica<span class=\"token punctuation\">.</span>sv_cgxmd cgxmd <span class=\"token keyword\">on</span> <span class=\"token punctuation\">(</span>cgxmj<span class=\"token punctuation\">.</span>aggid <span class=\"token operator\">=</span> cgxmd<span class=\"token punctuation\">.</span>aggid \n<span class=\"token operator\">and</span> cgxmj<span class=\"token punctuation\">.</span>nuecr5 <span class=\"token operator\">=</span> cgxmd<span class=\"token punctuation\">.</span>nuecr5 \n<span class=\"token operator\">and</span> cgxmj<span class=\"token punctuation\">.</span>nulimv <span class=\"token operator\">=</span> cgxmd<span class=\"token punctuation\">.</span>nulimv<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">left</span> <span class=\"token keyword\">outer</span> <span class=\"token keyword\">join</span> hive_default_lucid_prd<span class=\"token punctuation\">.</span>prd_srv_fni_a8401_fda_datastructure<span class=\"token punctuation\">.</span>sv_fni_ref_irt irt <span class=\"token keyword\">on</span> <span class=\"token punctuation\">(</span>code_irt <span class=\"token operator\">=</span> cgxmj<span class=\"token punctuation\">.</span>cdirt<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">where</span> \ncgxmj<span class=\"token punctuation\">.</span>insert_date <span class=\"token operator\">>=</span> ${env_ins_dt}\n<span class=\"token comment\">--Uncomment his filter to keep only the CRE YOGA</span>\n<span class=\"token comment\">--and cgxmj.cdggpn in ('07141','07142','07143','07144','07145','07146','07147','07148','07149')</span>\n<span class=\"token keyword\">group</span> <span class=\"token keyword\">by</span> \ncgxmj<span class=\"token punctuation\">.</span>insert_date<span class=\"token punctuation\">,</span> \ncgxmj<span class=\"token punctuation\">.</span>cdirt<span class=\"token punctuation\">,</span>\nlabel_irt<span class=\"token punctuation\">,</span>\n<span class=\"token keyword\">case</span> <span class=\"token keyword\">when</span> cgxmj<span class=\"token punctuation\">.</span>cdggpn <span class=\"token operator\">in</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'07141'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'07142'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'07143'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'07144'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'07145'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'07146'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'07147'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'07148'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'07149'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">then</span> <span class=\"token string\">'YOGA'</span> <span class=\"token keyword\">else</span> <span class=\"token string\">'RCGG'</span> <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">order</span> <span class=\"token keyword\">by</span> <span class=\"token number\">4</span> <span class=\"token keyword\">desc</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span> <span class=\"token keyword\">asc</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></code></pre></div>","frontmatter":{"title":"Migration Systeme Comptabilite","description":"Dans le cadre de migration entre Societe Generale et Credit du Nord, je m'occupe sur la partie du projet pour restitution de la data afin de control les phrase de la migration","date":"2022-11-01T00:00:00.000Z","slug":"/pensieve/yoga","tags":["Datalake","Finance/Comptable","Control data quality"]}}},"pageContext":{}},"staticQueryHashes":["1994492073","2009693873","2031412112","3825832676"]}