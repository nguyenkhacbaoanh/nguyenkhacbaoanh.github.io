{"componentChunkName":"component---src-templates-post-js","path":"/pensieve/spark/dynamique-overwrite","result":{"data":{"markdownRemark":{"html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/dcadb76fb492ce728dd7d725fb8ece2a/a71f4/Non-dynamique-overwrite-partition.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.142857142857146%; position: relative; bottom: 0; left: 0; background-image: url('data:image/svg+xml,%3csvg%20xmlns=\\'http://www.w3.org/2000/svg\\'%20width=\\'400\\'%20height=\\'180\\'%20viewBox=\\'0%200%20400%20180\\'%20preserveAspectRatio=\\'none\\'%3e%3cpath%20d=\\'M17%2025l-1%202-1%202v2l1%203%201%202h18l19-1%201-6v-4l-19-1-19%201m110%2075l1%2074a2626%202626%200%2000-1-74m34-73l-1%203-1%202-1%201%201%201%201%202%201%203h38v-6l-1-6h-37m108%2073a1037%201037%200%20002%200%201037%201037%200%2000-2%200M26%2049c-10%205-10%205%201%2010l8%204%208-4%2010-4%202-1-1-1-10-4-9-4-9%204m269%200l-8%205%2017%208c1%201%2018-7%2018-8l-18-9-9%204M28%2075c-10%201-15%204-12%208%206%206%2035%205%2035-2%200-2-5-5-9-5-7-2-9-2-14-1m147%200c-8%201-14%203-14%206%200%208%2028%209%2037%201%202-1%202-1%201-2-7-5-12-6-24-5m116%2020c-1%201-2%2014-1%2015%202%201%203%200%202-1-2-2-1-3%201-1%203%202%205%203%204%201v-1l1%201%202%201h3l-6%201%2011%201c16%200%2017%200%2018-2%201-1%202-3%201-4l1-2%201-2-2-2c0-4%200-4-1-3l-1-1c1-2-31-3-34-1M21%20131v10h19c2-1%202-3%202-6v-4l-10-1-11%201m145%202l-1%208v3h21v-11h-20m127%200l-1%207v6h15v-13l-7-1-7%201M26%20146l-5%203%205%203%206%203%205-3%205-3-5-3-5-3-6%203m142%204c-4%202-4%206%200%209%204%202%2012%202%2016-1l5-2%202-1-2-1-5-2c-4-3-10-4-16-2m127%203l-5%203%205%203c5%202%205%202%209%200%207-3%208-3%202-6-6-4-5-4-11%200m-269%204c-3%200-6%204-5%206%201%205%2013%206%2018%203l6-3%202-1-3-1-3-1c0-2-9-4-15-3\\'%20fill=\\'%2364ffda\\'%20fill-rule=\\'evenodd\\'/%3e%3c/svg%3e'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Image Alt\"\n        title=\"Image Alt\"\n        src=\"/static/dcadb76fb492ce728dd7d725fb8ece2a/39600/Non-dynamique-overwrite-partition.png\"\n        srcset=\"/static/dcadb76fb492ce728dd7d725fb8ece2a/1aaec/Non-dynamique-overwrite-partition.png 175w,\n/static/dcadb76fb492ce728dd7d725fb8ece2a/98287/Non-dynamique-overwrite-partition.png 350w,\n/static/dcadb76fb492ce728dd7d725fb8ece2a/39600/Non-dynamique-overwrite-partition.png 700w,\n/static/dcadb76fb492ce728dd7d725fb8ece2a/57cd1/Non-dynamique-overwrite-partition.png 1050w,\n/static/dcadb76fb492ce728dd7d725fb8ece2a/4af54/Non-dynamique-overwrite-partition.png 1400w,\n/static/dcadb76fb492ce728dd7d725fb8ece2a/a71f4/Non-dynamique-overwrite-partition.png 2441w\"\n        sizes=\"(max-width: 700px) 100vw, 700px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Quand -t-on essaie d'utiliser dynamique partition mode pour écrire des données avec ces deux methods:</p>\n<div class=\"gatsby-highlight\" data-language=\"scala\"><pre class=\"language-scala\"><code class=\"language-scala\">dataframe<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">.</span>option<span class=\"token punctuation\">(</span><span class=\"token string\">\"partitionOverwriteMode\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"dynamic\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>ou ajoute dans la configuration de <code class=\"language-text\">SparkSession</code></p>\n<div class=\"gatsby-highlight\" data-language=\"scala\"><pre class=\"language-scala\"><code class=\"language-scala\">sparkSession<span class=\"token punctuation\">.</span>conf<span class=\"token punctuation\">.</span>set<span class=\"token punctuation\">(</span><span class=\"token string\">\"spark.sql.sources.partitionOverwriteMode\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"dynamic\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>potentiellement, on rencontre ce genre d'erreur:</p>\n<blockquote>\n<p>Exception: Caused by: java.io.IOException: PathOutputCommitProtocol does not support dynamicPartitionOverwrite</p>\n</blockquote>\n<p>Il nous suffit desactiver <code class=\"language-text\">S3 committer</code> comme ci-dessous: (si vous êtes sur Cloudera)</p>\n<div class=\"gatsby-highlight\" data-language=\"scala\"><pre class=\"language-scala\"><code class=\"language-scala\">sparkSession<span class=\"token punctuation\">.</span>conf<span class=\"token punctuation\">.</span>set<span class=\"token punctuation\">(</span><span class=\"token string\">\"spark.sql.sources.commitProtocolClass\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"org.apache.spark.sql.execution.datasources.SQLHadoopMapReduceCommitProtocol\"</span><span class=\"token punctuation\">)</span>\n\nsparkSession<span class=\"token punctuation\">.</span>conf<span class=\"token punctuation\">.</span>set<span class=\"token punctuation\">(</span><span class=\"token string\">\"spark.cloudera.s3_committers.enabled\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"false\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/44e6d242bd671f7ef96d8d42573a5ede/a71f4/Dynamique-overwrite-partition.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.142857142857146%; position: relative; bottom: 0; left: 0; background-image: url('data:image/svg+xml,%3csvg%20xmlns=\\'http://www.w3.org/2000/svg\\'%20width=\\'400\\'%20height=\\'180\\'%20viewBox=\\'0%200%20400%20180\\'%20preserveAspectRatio=\\'none\\'%3e%3cpath%20d=\\'M141%2027l-11%206%2011%205%2012%206%2010-5%2010-6-10-6-10-6-12%206m112-3c-7%201-14%204-15%206l-2%202h-3c-3%200-3%200%200%201%202%201%206%202%207%204%204%204%205%204%2019%204%2010%200%2016-1%2020-4%2010-7-6-15-26-13m75%200l-7%201-1%207%201%208%209%201%208%201%201%201v-1l8-1c7%200%209%200%2010-2%202-2%202-2%201-3v-6c2%200-2-6-5-6h-25M37%2026v9l1%206h9l11%201h13l5-1h5V26l-1-2H38l-1%202M22%20131l-1%205v5h7c12%201%2014%200%2014-6v-4l-10-1-10%201m143%200c-1%202%200%209%201%2010h19l1-6v-4l-10-1-11%201m128%202l-1%207c0%207%200%207%209%206%206%200%206%200%206-7v-6l-7-1-7%201M25%20146c-5%203-5%203%201%206%205%203%206%203%2011%200s5-3%200-6c-6-2-6-2-12%200m143%206c-6%204-2%209%208%209l8-2c1-2%204-3%205-3%202-1%202-1%200-1l-5-2c-4-4-12-4-16-1m125%202c-5%203-5%203%201%206l6%203%204-2c6-3%206-4%200-7-5-2-5-2-11%200m-269%204l-3%204c-1%205%2012%207%2018%203l6-2c1%200%202%200%201-1l-2-1-4-2c-4-2-12-3-16-1\\'%20fill=\\'%2364ffda\\'%20fill-rule=\\'evenodd\\'/%3e%3c/svg%3e'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Image\"\n        title=\"Image\"\n        src=\"/static/44e6d242bd671f7ef96d8d42573a5ede/39600/Dynamique-overwrite-partition.png\"\n        srcset=\"/static/44e6d242bd671f7ef96d8d42573a5ede/1aaec/Dynamique-overwrite-partition.png 175w,\n/static/44e6d242bd671f7ef96d8d42573a5ede/98287/Dynamique-overwrite-partition.png 350w,\n/static/44e6d242bd671f7ef96d8d42573a5ede/39600/Dynamique-overwrite-partition.png 700w,\n/static/44e6d242bd671f7ef96d8d42573a5ede/57cd1/Dynamique-overwrite-partition.png 1050w,\n/static/44e6d242bd671f7ef96d8d42573a5ede/4af54/Dynamique-overwrite-partition.png 1400w,\n/static/44e6d242bd671f7ef96d8d42573a5ede/a71f4/Dynamique-overwrite-partition.png 2441w\"\n        sizes=\"(max-width: 700px) 100vw, 700px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>","frontmatter":{"title":"Spark - Dynamique partition overwrite data","description":"Overwrite data par partition.","date":"2021-06-04T00:00:00.000Z","slug":"/pensieve/spark/dynamique-overwrite","tags":["spark","partition","scala"]}}},"pageContext":{}},"staticQueryHashes":["1994492073","2009693873","2031412112","3825832676"]}